<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Kai's YT Hack</title>
    <style type="text/css">
      body { font-family: Arial; }
      a { text-decoration: none; }
      #videoDiv { margin-right: 3px; }
      #lyrics { margin-left: 3px; font-size: 80%; }
      #volumeSetting { width: 25px; }
      .number, .key { display: inline-block; }
      .number { width: 20px; text-align: right; }
      .key { width: 20px; }
      .lyric { background-color: white; margin: 0px; padding: 0px; border-style: solid; border-width: 1px; border-color: white; }
      #currentLyric { font-size: 120%; }
      #dashboard { background-color: white; overflow: auto; }
      #col0, #col1, #col2, #col3, #col4 { display:block; float:left; width: 170px; }
      #col0 { width: 500px; height: 480px; background-color: white; }
      #col3, #col4 { xbackground-color: pink; width: 160px; }
      img { zoom: 50%; }
    </style>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      // YouTube JavaScript Player
      // https://developers.google.com/youtube/js_api_reference
      google.load("swfobject", "2.1");
    </script>
    <script type="text/javascript">
      var lyrics = [
		       { start: "00:00:27", finish: "00:00:00", label: "First verse" },
		       { start: "00:00:27", finish: "00:00:00", label: "對這個世界如果你有太多的抱怨" },
		       { start: "00:00:31", finish: "00:00:00", label: "跌倒了就不敢繼續往前走" },
		       { start: "00:00:34", finish: "00:00:00", label: "為什麼人要這麼的脆弱墮落" },
		       { start: "00:00:38", finish: "00:00:00", label: "請你打開電視看看" },
		       { start: "00:00:40", finish: "00:00:00", label: "多少人為生命在努力勇敢的走下去" },
		       { start: "00:00:44", finish: "00:00:00", label: "我們是不是該知足" },
		       { start: "00:00:46", finish: "00:00:00", label: "珍惜一切就算沒有擁有" },
		       { start: "00:00:50", finish: "00:00:00", label: "Chorus" },
		       { start: "00:00:51", finish: "00:00:00", label: "還記得你說家是唯一的城堡" },
		       { start: "00:00:54", finish: "00:00:00", label: "隨著稻香河流繼續奔跑" },
		       { start: "00:00:57", finish: "00:00:00", label: "微微笑小時候的夢我知道" },
		       { start: "00:01:02", finish: "00:00:00", label: "不要哭讓螢火蟲帶著你逃跑" },
		       { start: "00:01:06", finish: "00:00:00", label: "鄉間的歌謠永遠的依靠" },
		       { start: "00:01:09", finish: "00:00:00", label: "回家吧回到最初的美好" },
		       { start: "00:01:37", finish: "00:00:00", label: "Second verse" },
		       { start: "00:01:37.5", finish: "00:00:00", label: "不要這麼容易就想放棄" },
		       { start: "00:01:41.3", finish: "00:00:00", label: "追不到的夢想換個夢不就得了" },
		       { start: "00:01:44.5", finish: "00:00:00", label: "為自己的人生鮮艷上色" },
		       { start: "00:01:46.5", finish: "00:00:00", label: "先把愛塗上喜歡的顏色" },
		       { start: "00:01:49.5", finish: "00:00:00", label: "笑一個吧功成名就不是目的" },
		       { start: "00:01:52.3", finish: "00:00:00", label: "讓自己快樂快樂這才叫做意義" },
		       { start: "00:01:55.3", finish: "00:00:00", label: "童年的紙飛機現在終於飛回我手裡" },
		       { start: "00:02:00", finish: "00:00:00", label: "所謂的那快樂" },
		       { start: "00:02:02.3", finish: "00:00:00", label: "赤腳在田裡追蜻蜓追到累了" },
		       { start: "00:02:05", finish: "00:00:00", label: "偷摘水果被蜜蜂給叮到怕了" },
		       { start: "00:02:08", finish: "00:00:00", label: "誰在偷笑呢" },
		       { start: "00:02:10", finish: "00:00:00", label: "我靠著稻草人吹著風唱著歌睡著了" },
		       { start: "00:02:13", finish: "00:00:00", label: "哦哦午後吉它在蟲鳴中更清脆" },
		       { start: "00:02:16", finish: "00:00:00", label: "哦哦陽光灑在路上就不怕心碎" },
		       { start: "00:02:20", finish: "00:00:00", label: "珍惜一切就算沒有擁有" }
      ];
      
      String.prototype.seconds2Time = function () {
        var sec_num = parseInt(this, 10);
	var hours   = Math.floor(sec_num / 3600);
	var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
	var seconds = sec_num - (hours * 3600) - (minutes * 60);

	if (hours   < 10) {hours   = "0"+hours;}
	if (minutes < 10) {minutes = "0"+minutes;}
	if (seconds < 10) {seconds = "0"+seconds;}
	var time = hours+':'+minutes+':'+seconds;
	return time;
      }
      String.prototype.time2Seconds = function () {
          var a = this.split(':');
	  return (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]); 
      }
      function updateHTML(elmId, value) {
        document.getElementById(elmId).innerHTML = value;
      }
      function updateHTMLfield(elmId, value) {
        document.getElementById(elmId).value = value;
      }
      function onPlayerError(errorCode) {
        alert("An error occured of type:" + errorCode);
      }
      function onPlayerStateChange(newState) {
        var state = "";
        switch (newState) {
          case 1: state = "Playing"; break;
          case 2: state = "Paused"; break;
          case 3: state = "Buffering"; break;
          case 0: state = "Ended"; break;
          case 5: state = "Video cued"; break;
          case -1: state = "--"; break; // "Unstarted"
          default: state = "Player state: " + newState;
        }
        updateHTML("playerState", state);
      }
      var currentLyric = -1;
      function updateCurrentLyric() {
        if (ytplayer) {
	  var curTime = ytplayer.getCurrentTime();
	  // display which lyric is playing according to the time in seconds
	  for (var i = 0; i < lyrics.length; i++) {
	    var ly = lyrics[i];
	    if (curTime < ly.pseconds) {
	      break;
	    }
	  }
          var lyric = i - 1;
	  if (lyric != currentLyric) {
	    var ly = lyrics[lyric];
	    //document.getElementById('l'+lyric).style.backgroundColor = "yellow";
	    document.getElementById('l'+lyric).style.borderColor = "black";
            document.getElementById('currentLyric').innerHTML = ly.label;
            if (currentLyric >= 0) {
	      //document.getElementById('l'+lyric).style.backgroundColor = "white";
	      document.getElementById('l'+lyric).style.borderColor = "white";
            }
            currentLyric = lyric;
          }
        }
      }
      function updatePlayerInfo() {
        // Also check that at least one function exists since when IE unloads the
        // page, it will destroy the SWF before clearing the interval.
        if(ytplayer && ytplayer.getDuration) {
          updateHTML("videoDuration", (ytplayer.getDuration()+"").seconds2Time());
          updateHTML("videoCurrentTime", ((Math.round(ytplayer.getCurrentTime()*10)/10)+"").seconds2Time());
          if (document.activeElement.id != "volumeSetting")
            updateHTMLfield("volumeSetting", Math.round(ytplayer.getVolume()));
          //updateCurrentLyric(ytplayer.getDuration());
        }
      }
      function setVideoVolume() {
        var volume = parseInt(document.getElementById("volumeSetting").value);
        if(isNaN(volume) || volume < 0 || volume > 100) {
          //alert("Please enter a valid volume between 0 and 100.");
        }
        else if(ytplayer){
          ytplayer.setVolume(volume);
        }
      }
      function playVideo() {
        if (ytplayer) {
          ytplayer.playVideo();
        }
      }
      function pauseVideo() {
        if (ytplayer) {
          ytplayer.pauseVideo();
        }
      }
      function muteVideo() {
        if(ytplayer) {
          ytplayer.mute();
        }
      }      
      function unMuteVideo() {
        if(ytplayer) {
          ytplayer.unMute();
        }
      }
      function seekTo(seconds, allowSeekAhead) {
        if (ytplayer) {
          ytplayer.seekTo(seconds, allowSeekAhead);
        }
      }
      function seekToRelative(seconds) {
        if (ytplayer) {
          var cur = ytplayer.getCurrentTime();
          cur = Math.max(cur + seconds, 0);
          seekTo(cur, true);
        }
      }
      function seekNextLyric(increment) {
        if (ytplayer) {
          var lyric = Math.max(0, Math.min(currentLyric + increment, lyrics.length - 1));
          seekTo(lyrics[lyric].pseconds, true);
        }
      }
      // The video to load. 
      //var videoID = "OIiU2-JyqsE" 
      //var videoID = "Ej5rGGTHy54" // WTC
      var videoID = "8IsrKKd5laI" // Jay Chou

      
      // Standard API function is called by the player once it loads
      // https://developers.google.com/youtube/js_api_reference
      function onYouTubePlayerReady(playerId) {
        ytplayer = document.getElementById("ytPlayer");
        // This causes the updatePlayerInfo function to be called every 250ms to
        // get fresh data from the player
        setInterval(updatePlayerInfo, 250);
        updatePlayerInfo();
        ytplayer.addEventListener("onStateChange", "onPlayerStateChange");
        ytplayer.addEventListener("onError", "onPlayerError");
        ytplayer.cueVideoById(videoID);
	ytplayer.setPlaybackQuality("hd720");
      }
      function lyricsHTML() {
        var html = '<div>';
	for (var i = 0; i < lyrics.length; i++) {
	  var ly = lyrics[i];
	  ly.startSec = ly.start.time2Seconds()
          html += '<div class="lyric" id="l' + i + '"><span class="label">' + ly.label+ '</span> ';
          html += '<a href="javascript:void(0);" onclick="seekTo(' + ly.startSec + ', true);" title="' + ly.start + '">Go</a> ';
	}
        html += '</div>';
        return html;	
      }
      // The "main method" of this sample. Called when someone clicks "Run".
      function loadPlayer() {
        // Lets Flash from another domain call JavaScript
        var params = { allowScriptAccess: "always" };
        // The element id of the Flash embed
        var atts = { id: "ytPlayer" };
        // All of the magic handled by SWFObject (http://code.google.com/p/swfobject/)
        swfobject.embedSWF(//"http://www.youtube.com/apiplayer?" + "version=3&enablejsapi=1&playerapiid=player1",
		           "http://www.youtube.com/v/" + videoID + "?version=3&enablejsapi=1&playerapiid=player1", 
                           "videoDiv", "480", "295", "9", null, null, params, atts);
        document.getElementById("volumeSetting").onkeyup = function(){ setVideoVolume() };
        document.onkeydown = function() {
	  switch (window.event.keyCode) {
	      case 37: seekNextLyric(-1); break; // left key
	      case 38: seekNextLyric(-1); break; // left key
	      case 39: seekNextLyric(1);  break; // right key
	      case 40: seekNextLyric(1);  break; // right key
	  }
        }
      }
      function _run() {
        loadPlayer();
        document.getElementById("lyrics").innerHTML = lyricsHTML();
      }
      google.setOnLoadCallback(_run);
    </script>
  </head>
  <body>
  <div id="dashboard">
    <div id="col0">
      <div id="videoDiv">Loading...</div>
      <div id="currentLyric">...</div>
      <div>
	<a href="javascript:void(0);" onclick="seekToRelative(-30);">&lt;&lt;</a>  
	<a href="javascript:void(0);" onclick="seekToRelative(-5);">&lt;</a>  
        <a href="javascript:void(0);" onclick="playVideo();">Play</a> | 
	<a href="javascript:void(0);" onclick="pauseVideo();">Pause</a> 
	<a href="javascript:void(0);" onclick="seekToRelative(5);">&gt;</a>
	<a href="javascript:void(0);" onclick="seekToRelative(30);">&gt;&gt;</a>
	<span id="playerState">--</span>
        <span id="videoCurrentTime">--:--</span> / <span id="videoDuration">--:--</span>
	<a href="javascript:void(0);" onclick="seekNextLyric(-1);">&lt;</a>  
	<a href="javascript:void(0);" onclick="seekNextLyric(1);">&gt;</a>  
	<br>
        Volume <input id="volumeSetting" type="text" size="3" /> 
        <a href="javascript:void(0);" onclick="muteVideo();">Mute</a> |
        <a href="javascript:void(0);" onclick="unMuteVideo();">Unmute</a>
      </div>
    </div>
    <div id="lyrics">...</div>
  </div>
  </body>
</html>
