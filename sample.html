<!DOCTYPE html>
<html>
  <head>
    <!-- Show subtitles for a Youtube Video.
	 Started from sample here: https://developers.google.com/youtube/iframe_api_reference -->
    <meta charset="utf-8">
    <title>Test subtitling Youtube Video</title>
    <style>
      #credits { font-size: 0.6em; }
      #player { xfloat:right; }
      /* this puts the video in full screen background */
      #player_full {
	  position: absolute;
	  width: 100%;
	  height: 100%;
	  top: 0;
	  left: 0;
	  bottom: 0;
	  right: 0;
	  display: flex;
	  flex-direction: column;
	  justify-content: center;
	  align-items: center;
	  z-index: -1;
      }
      #playertitle, #playertime {
	  color:black; background-color: white; opacity: 0.8; xtext-align: center;
      }
      xiframe {
	  /* optional */
	  width: 100%;
	  height: 100%; 
      }      
    </style>
    <script>
      //var synth;
      window.onload = function () {
	//document.getElementById('examples').innerHTML = html;
      }
    </script>
  </head>
  <body>
    <div id="player">[video]</div>    
    <div id="playertitle">[movement title]</div>
    <div id="playertime">[video timecode]</div>
    <script>
      // 1. load the IFrame Player API code asynchronously.
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 2. the API calls this function after page downloaded player API
      var player;
      var curvol;
      function onYouTubeIframeAPIReady() {
	console.log("iframe player API ready");
	// create an <iframe> (and YouTube player) after the API code downloads.
	// Embedded players must have a viewport that is at least 200px by 200px
        player = new YT.Player('player', {
          height: '200',
          width: '400', // for 16/9 aspect ratio
          videoId: 'QrrdWYh9Hwc',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
	});
	setupTitles();
      }
      var titles;
      function setupTitles() {
	titles = document.getElementById('titles').innerHTML.split(/\n/).map(function(s) {
	  var i = s.indexOf(' ');
	  var timecode = s.slice(0, i).trim();
	  var title = s.slice(i + 1, s.length).trim();
	  return { 'timecode' : timecode, 'title' : title, 'seconds' : time2seconds(timecode) };
	});
	let list = [];
	for (let i = 0; i < titles.length; i++) {
	  list.push((i+1)+'. '+titles[i].timecode+' '+titles[i].title+'<br/>');
	}
	document.getElementById('titles').innerHTML = list.join("");
      }
      function searchTitle(seconds) {
	let i = 0;
	for (; i < titles.length; i++) {
	  if (seconds < titles[i].seconds) {
	    break;
	  }
	}
	return i - 1;
      }
      function time2seconds(timecode) {
	var times = timecode.split(":");
	var seconds = 0;
	for (let i = 0; i < times.length; i++) {
	  seconds += Math.pow(60,i) * times[times.length - i - 1];
	}
	return seconds;
      }

      // 3. the API will call this function when the video player is ready.
      function onPlayerReady(event) {
	console.log("player ready");
	var playerTitle = document.getElementById('playertitle');	
	var playerTime = document.getElementById('playertime');	
	// just go ahead and start the video when the player is ready
	// this will start the video at the point where it was last played
	// since we just want to cue up the video, we set the volume to zero
	curvol = player.getVolume()
	player.setVolume(0);
	event.target.playVideo();
	setInterval(function() {
	  let date = new Date(null);
	  let curtime = player.getCurrentTime();
	  date.setSeconds(curtime);
	  playerTime.innerText = date.toISOString().substr(11, 8);
	  let titlecnt = searchTitle(curtime)
	  playerTitle.innerText = (titlecnt + 1) + '. ' + titles[titlecnt].title;
	}, 100);	
      }

      // 4. The API calls this function when the player's state changes.
      var done = false;
      function onPlayerStateChange(event) {
	//console.log("player state change: ", Object.keys(YT.PlayerState).find(key => YT.PlayerState[key] === event.data));
	if (event.data == YT.PlayerState.PLAYING && !done) {
	  // try to cue up the video but leave it paused
	  // restore original volume after paused
	  player.pauseVideo();
	  player.setVolume(curvol);
          done = true;
        }
      }
    </script>
    <div id="titles">00:00 Kommt, ihr Töchter, helft mir klagen (Chor)
05:50 Da Jesus diese Rede vollendet hatte (Rezitativ)
06:38 Herzliebster Jesu (Chor)
07:30 Da versammelten sich die Hohenpriester (Rezitativ)
10:40 Du lieber Heiland du (Accompagnato-Rezitativ)
11:28 Buß und Reu (Arie)
15:07 Da ging hin der Zwölfen einer (Rezitativ)
15:44 Blute nur, du liebes Herz! (Arie)
19:40 Aber am ersten Tage der süßen Brot (Rezitativ)
21:44 Herr, bin ich’s? (Chor)
22:50 Er antwortete und sprach (Rezitativ)
25:45 Wiewohl mein Herz in Tränen schwimmt (Acc.-Rezitativ)
26:50 Ich will dir mein Herze schenken (Arie)
30:10 Und da sie den Lobgesang gesprochen hatten (Rezitativ)
31:10 Erkenne mich, mein Hüter (Chor)
32:18 Petrus aber antwortete (Rezitativ)
33:25 Ich will hier bei dir stehen (Chor)
34:33 Da kam Jesus mit ihnen zu einem Hofe (Rezitativ)
36:12 Hier zittert das gequälte Herz (Acc.-Rezitativ)
37:55 Ich will bei meinem Jesu wachen (Arie)
42:43 Und ging hin ein wenig (Rezitativ)
43:28 Der Heiland fällt vor seinem Vater nieder (Acc.-Rezitativ)
44:18 Gerne will ich mich bequemen (Arie)
47:55 Und er kam zu seinen Jüngern (Rezitativ)
49:15 Was mein Gott will, das g’scheh allzeit (Chor)
50:25 Und er kam und fand sie aber schlafend (Rezitativ)
52:50 So ist mein Jesus nun gefangen (Arie)
56:09 Sind Blitze, sind Donner in Wolken verschwunden? (Chor)
57:18 Und siehe, einer aus denen (Rezitativ)
59:43 O Mensch, bewein dein Sünde groß (Chor)
01:05:00 Ach! nun ist mein Jesus hin! (Arie)
01:08:15 Die aber Jesum gegriffen hatten (Rezitativ)
01:09:27 Mir hat die Welt trüglich gericht’ (Chor)
01:10:18 Und wiewohl viel falsche Zeugen herzutraten (Rezitativ)
01:11:32 Mein Jesus schweigt (Acc.-Rezitativ)
01:12:30 Geduld! Wenn mich falsche Zungen stechen (Arie)
01:15:43 Und der Hohepriester antwortete (Rezitativ)
01:17:04 Er ist des Todes schuldig! (Chor)
01:17:52 Wer hat dich so geschlagen (Chor)
01:18:48 Petrus aber saß draußen (Rezitativ)
01:21:14 Erbarme dich (Arie)
01:26:15 Bin ich gleich von dir gewichen (Chor)
01:27:28 Des Morgens aber hielten alle Hohepriester (Rezitativ)
01:29:28 Gebt mir meinen Jesum wieder! (Arie)
01:32:04 Sie hielten aber einen Rat (Rezitativ)
01:34:20 Befiehl du deine Wege (Chor)
01:35:33 Auf das Fest aber hatte der Landpfleger Gewohnheit
01:37:45 Laß ihn kreuzigen! (Chor)
01:38:55 Der Landpfleger sagte (Rezitativ)
01:39:12 Er hat uns allen wohlgetan (Acc.-Rezitativ)
01:40:08 Aus Liebe will mein Heiland sterben (Arie)
01:44:29 Sie schrieen aber noch mehr (Rezitativ)
01:46:26 Erbarm es Gott! (Acc.-Rezitativ)
01:47:20 Können Tränen meiner Wangen (Arie)
01:53:30 Da nahmen die Kriegsknechte (Rezitativ)
01:54:40 O Haupt voll Blut und Wunden (Chor)
01:56:58 Und da sie ihn verspottet hatten (Rezitativ)
01:58:05 Ja freilich will in uns (Acc.-Rezitativ)
01:58:40 Komm, süßes Kreuz (Arie)
02:03:32 Und da sie an die Stätte kamen (Rezitativ)
02:07:09 Ach Golgatha (Acc.-Rezitativ)
02:08:20 Sehet, Jesus hat die Hand (Arie)
02:11:11 Und von der sechsten Stunde an (Rezitativ)
02:13:30 Wenn ich einmal soll scheiden (Chor)
02:17:40 Am Abend, da es kühle war (Acc.-Rezitativ)
02:19:18 Mache dich, mein Herze, rein (Arie)
02:24:32 Und Joseph nahm den Leib (Rezitativ)
02:27:06 Nun ist der Herr zur Ruh gebracht (Acc.-Rezitativ)
02:28:50 Wir setzen uns mit Tränen nieder (Schlusschor)</div>
    <p id="credits">
      Source code:
      <a target="_blank" href="https://github.com/kaicarver/ytplayer">https://github.com/kaicarver/ytplayer</a>
    </p>
  </body>
</html>
